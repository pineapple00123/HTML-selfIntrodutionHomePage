<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gantt Chart with Dates</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
</head>
<body>
<canvas id="ganttChartCanvas" width="2000" height="400" style="background-color: lightgray"></canvas>

<script>
  // 캔버스 요소 가져오기
  const canvas = document.getElementById('ganttChartCanvas');
  const context = canvas.getContext('2d');

  // 간트 차트 데이터 정의
  const tasks = [
    { name: 'Task 1', start: new Date(2023, 0, 1), duration: 5 },
    { name: 'Task 2', start: new Date(2023, 0, 6), duration: 3 },
    { name: 'Task 3', start: new Date(2023, 0, 9), duration: 6 },
    { name: 'Task 4', start: new Date(2023, 0, 15), duration: 4 },
  ];

  // 간트 차트 그리기 함수
  function drawGanttChart() {
    // 간트 차트의 시작 위치
    const chartX = 100;
    const chartY = 50;

    // 간트 차트의 가로 세로 크기
    const chartWidth = canvas.width - chartX * 2;
    const chartHeight = canvas.height - chartY * 2;

    // 간트 차트 그리기
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.fillStyle = 'lightgray';
    context.fillRect(chartX, chartY, chartWidth, chartHeight);

    // 날짜 그리기
    drawDates(chartX, chartY, chartWidth, chartHeight);

    // 각 작업 그리기
    tasks.forEach((task, index) => {
      const taskX = chartX + getDayDiff(tasks[0].start, task.start) * (chartWidth / getTotalDayDiff(tasks[0].start, tasks[tasks.length - 1].start));
      const taskY = chartY + (index + 1) * 30;
      const taskWidth = task.duration * (chartWidth / getTotalDayDiff(tasks[0].start, tasks[tasks.length - 1].start));
      const taskHeight = 20;

      context.fillStyle = 'blue';
      context.fillRect(taskX, taskY, taskWidth, taskHeight);

      context.fillStyle = 'white';
      context.font = '12px Arial';
      context.fillText(task.name, taskX + 5, taskY + 15);
    });
  }

  // 날짜 그리기 함수
  function drawDates(chartX, chartY, chartWidth, chartHeight) {
    const startDate = tasks[0].start;
    const endDate = tasks[tasks.length - 1].start;

    const totalDays = getTotalDayDiff(startDate, endDate);
    const daysPerPixel = chartWidth / totalDays; // 수정된 부분

    context.fillStyle = 'black';
    context.font = '12px Arial';
    context.textAlign = 'center';

    for (let i = 0; i <= totalDays; i++) {
      const date = addDays(startDate, i);
      const dayX = chartX + i * daysPerPixel; // 수정된 부분
      const dayY = chartY + chartHeight + 20;

      context.fillText(formatDate(date), dayX, dayY);
    }
  }

  // 두 날짜 사이의 총 일수 계산
  function getTotalDayDiff(startDate, endDate) {
    const oneDay = 24 * 60 * 60 * 1000; // 1일의 밀리초 수
    return Math.round(Math.abs((startDate - endDate) / oneDay));
  }

  // 특정 날짜에 일수 더하기
  function addDays(date, days) {
    const result = new Date(date);
    result.setDate(result.getDate() + days);
    return result;
  }

  // 날짜를 문자열로 포맷팅
  function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  // 두 날짜 사이의 일수 계산
  function getDayDiff(startDate, endDate) {
    const oneDay = 24 * 60 * 60 * 1000; // 1일의 밀리초 수
    return Math.round(Math.abs((startDate - endDate) / oneDay));
  }

  // 간트 차트 그리기 호출
  drawGanttChart();
</script>
</body>
</html>
